<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥½åƒä¸éŒ¯</title>
    <style>
        body { 
            background-color: #f2ede4; 
            color: #333333; 
            font-family: "Noto Serif TC", serif; 
            text-align: center; 
            margin: 0; 
            padding: 40px 20px; 
            user-select: none;
        }

        .container { max-width: 500px; margin: 0 auto; }
        h1 { font-size: 2rem; letter-spacing: 2px; margin-bottom: 8px; cursor: default; }
        p { font-size: 1.1rem; opacity: 0.8; margin-bottom: 30px; cursor: default; }

        .note-box { 
            background: transparent; 
            min-height: 350px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            margin-bottom: 20px;
            perspective: 1000px; 
            position: relative;
        }

        #note-img { 
            width: 100%; 
            max-width: 400px; 
            height: auto; 
            opacity: 0; 
            transform: translateY(20px);
            transition: opacity 0.4s ease, transform 0.4s ease; 
            z-index: 2;
        }

        #note-img.loaded {
            opacity: 1;
            transform: translateY(0);
        }

        #loading-text {
            position: absolute;
            color: #b5af9f;
            font-size: 0.9rem;
            z-index: 1;
        }

        button { 
            background: #5d5d5d; color: white; border: none; 
            padding: 12px 28px; cursor: pointer; margin: 10px 5px; 
            border-radius: 4px; font-size: 1rem;
            transition: background 0.2s;
        }
        button:active { background: #333; }
        .btn-outline { background: transparent; color: #5d5d5d; border: 1px solid #5d5d5d; }

        .grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
            margin-top: 10px;
            padding-bottom: 80px;
        }
        .grid img { 
            width: 100%; 
            aspect-ratio: 1/1; 
            object-fit: cover; 
            border-radius: 2px; 
            cursor: zoom-in;
            background: #e6e0d5; 
        }

        #lightbox {
            display: none;
            position: fixed;
            top: 0; left: 0; 
            width: 100%; height: 100%;
            background: #f2ede4; 
            z-index: 2000;
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
        }

        #lightbox img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
        }

        .fixed-controls {
            position: fixed; bottom: 30px; left: 50%;
            transform: translateX(-50%); z-index: 1000;
            display: none;
        }

        /* ğŸ¤« éš±èº«è¨ˆæ•¸å™¨æ¨£å¼ï¼šå¹³å¸¸çœ‹ä¸è¦‹ï¼Œåç™½æ‰å‡ºç¾ */
        #counter-area {
            margin-top: 100px;
            font-size: 10px;
            color: #f2ede4; /* è·ŸèƒŒæ™¯è‰²ä¸€æ¨£ï¼Œé”æˆéš±å½¢ */
            user-select: text !important; /* å¼·åˆ¶å…è¨±é¸å– */
        }
        #counter-area img {
            height: 12px;
            opacity: 0.01; /* æ¥µä½é€æ˜åº¦ï¼Œå¹³å¸¸çœ‹ä¸è¦‹ */
            filter: grayscale(100%);
        }
        /* ç•¶è©²å€åŸŸè¢«é¸å–æ™‚ */
        #counter-area::selection {
            background: #5d5d5d;
            color: #ffffff;
        }
        #counter-area img::selection {
            opacity: 1;
        }
    </style>
</head>
<body>

    <div class="container" id="main-section">
        <h1> (Â´âŠ™Ï‰âŠ™`)</h1>
        <p>å·å·åœ°çœ‹ç´™æ¢ï¼Œå¥½åƒä¸éŒ¯ã€‚</p>
        
        <div class="note-box">
            <div id="loading-text">æ­£åœ¨ç¿»é–±ç´™æ¢...</div>
            <img id="note-img" src="" alt="ç´™æ¢å…§å®¹">
        </div>

        <div class="controls">
            <button onclick="draw()">å†çœ‹ä¸€å¼µ</button>
            <button class="btn-outline" onclick="showAll()">æˆ‘å…¨éƒ½è¦</button>
        </div>

        <div id="counter-area">
            . stats: <img src="https://count.getloli.com/get/@soundsnice286_notes?theme=moebooru" alt="hits">
        </div>
    </div>

    <div class="container" id="gallery-section">
        <div class="grid" id="grid-content"></div>
    </div>

    <div id="lightbox" onclick="closeLightbox()">
        <img id="lightbox-img" src="" alt="æ”¾å¤§æª¢è¦–">
    </div>

    <div class="fixed-controls" id="back-btn">
        <button onclick="hideAll()">å›å»æŠ½ç´™æ¢</button>
    </div>

<script>
    // ==========================================
    // â­ ä¿®æ”¹é€™è£¡ï¼šåœ–ç‰‡ç¸½å¼µæ•¸
    // ==========================================
    const total = 176;     
    
    const folder = "images";
    const ext = ".webp"; 
    
    let pool = []; 
    const imgElement = document.getElementById('note-img');
    const loadingText = document.getElementById('loading-text');

    function shufflePool() {
        pool = Array.from({length: total}, (_, i) => i + 1);
        for (let i = pool.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [pool[i], pool[j]] = [pool[j], pool[i]];
        }
    }

    function draw() {
        if (pool.length === 0) { shufflePool(); }
        const num = pool.pop();
        imgElement.classList.remove('loaded');
        loadingText.style.display = 'block';
        const path = `${folder}/${num}${ext}?v=${new Date().getTime()}`;
        
        setTimeout(() => {
            imgElement.src = path;
            imgElement.onload = () => { 
                imgElement.classList.add('loaded'); 
                loadingText.style.display = 'none';
            };
        }, 150);
    }

    function showAll() {
        document.getElementById('main-section').style.display = 'none';
        document.getElementById('gallery-section').style.display = 'block';
        document.getElementById('back-btn').style.display = 'block';
        const grid = document.getElementById('grid-content');
        if (grid.innerHTML === "") {
            const fragment = document.createDocumentFragment();
            for (let i = 1; i <= total; i++) {
                const item = document.createElement('img');
                const src = `${folder}/${i}${ext}`;
                item.src = src;
                item.loading = "lazy";
                item.onclick = () => openLightbox(src);
                fragment.appendChild(item);
            }
            grid.appendChild(fragment);
        }
        window.scrollTo(0, 0);
    }

    function openLightbox(src) {
        const lb = document.getElementById('lightbox');
        const lbImg = document.getElementById('lightbox-img');
        lbImg.src = src;
        lb.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
        document.getElementById('lightbox').style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    function hideAll() {
        document.getElementById('gallery-section').style.display = 'none';
        document.getElementById('back-btn').style.display = 'none';
        document.getElementById('main-section').style.display = 'block';
        window.scrollTo(0, 0);
    }

    window.onload = draw;
</script>
</body>
</html>
